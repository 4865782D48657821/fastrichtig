{{ define "main" }}
  <article class="post">
    <h1 class="post-title">
      <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a>
    </h1>

    {{ with .Content }}
      <div class="post-content">
        <div>
          {{ . | replaceRE "(<h[1-9] id=\"([^\"]+)\".+)(</h[1-9]+>)" `${1}<a href=\"#${2}\" class=\"hanchor\" ariaLabel=\"Anchor\">#</a> ${3}` | safeHTML }}
        </div>
      </div>
    {{ end }}
  </article>

  {{ $tags := slice }}
  {{ with .Params.tag }}
    {{ $tags = $tags | append . }}
  {{ end }}
  {{ with .Params.tags }}
    {{ if (reflect.IsSlice .) }}
      {{ range . }}
        {{ $tags = $tags | append . }}
      {{ end }}
    {{ else }}
      {{ $tags = $tags | append . }}
    {{ end }}
  {{ end }}

  {{ $posts := where .Site.RegularPages "Type" "posts" }}
  {{ if gt (len $tags) 0 }}
    {{ $posts = where $posts "Params.tags" "intersect" $tags }}
  {{ end }}
  {{ $posts = sort $posts "Date" "desc" }}

  <div class="posts">
    {{ if gt (len $posts) 0 }}
      {{ range $posts }}
        <article class="post on-list">
          <h2 class="post-title">
            <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a>
          </h2>
          <div class="post-meta">
            {{- if .Date -}}
              <time class="post-date">
                {{- partial "post-date" . -}}
              </time>
            {{- end -}}
            {{- with .Params.Author -}}
              <span class="post-author">{{- . -}}</span>
            {{- end -}}
          </div>

          {{ if .Params.tags }}
            <span class="post-tags">
              {{ range .Params.tags }}
              #<a href="{{ (urlize (printf "tags/%s/" . )) | absLangURL }}">
                {{- . -}}
              </a>&nbsp;
              {{ end }}
            </span>
          {{ end }}

          {{ partial "cover.html" . }}

          <div class="post-content">
            {{ if .Params.showFullContent }}
              {{ .Content }}
            {{ else if .Description }}
              <p>{{ .Description | markdownify }}</p>
            {{ else }}
              {{ .Summary }}
            {{ end }}
          </div>

          {{ if not .Params.showFullContent }}
             <div>
              <a class="read-more button inline" href="{{ .RelPermalink }}">[{{ $.Site.Params.ReadMore }}]</a>
            </div>
          {{ end }}
        </article>
      {{ end }}

    {{ else }}
      <article class="post on-list">
        <div class="post-content">
          <p>Keine Beitraege fuer dieses Tag gefunden.</p>
        </div>
      </article>
    {{ end }}
  </div>
{{ end }}
